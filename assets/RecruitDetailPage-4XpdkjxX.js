import{j as r,c as f,u as S,b as D,d as C,f as A,a as R,r as u}from"./index-DxpxDltw.js";import{H as k}from"./Header-BgHfIuck.js";import{P as I}from"./Chip_period-ClNg_VhG.js";import{f as L}from"./date-B0GoYsVM.js";import{S as P,a as E,r as F,b as T}from"./recruitment-DG7YAS80.js";import{C as q}from"./CTABtn-BwcnF83I.js";import{u as B}from"./useQuery-CQFd5AoP.js";import{u as H}from"./useMypageData-Ce-cdX-3.js";import"./icn_search_24-2-CMkeuNQX.js";import"./ic_arrow_left_24-BeN98Wln.js";import"./user-f_T0lY3j.js";const M=({title:e,status:s,dDay:i,createdAt:c})=>r.jsxs("section",{className:"px-4 pt-6 pb-4 bg-white",children:[r.jsx("div",{className:"mb-2",children:r.jsx(I,{status:s,dDay:i,size:"large"})}),r.jsx("h1",{className:"text-[18px] font-semibold text-gray-900 leading-[135%] tracking-[-0.03em]",children:e}),r.jsxs("p",{className:"mt-1 text-sm font-medium text-gray-400 leading-[135%] tracking-[-0.03em]",children:["게시일 ",L(c)]})]}),Q=({imageUrl:e})=>e?r.jsx("section",{className:"bg-white px-4",children:r.jsx("img",{src:e,alt:"모집 공고 이미지",className:"w-full rounded-lg object-cover"})}):null,$=({description:e})=>{const s=e.replace(/\\n/g,`
`);return r.jsx("section",{className:"bg-gray-50 rounded-[12px] px-4 py-5 mt-6",children:r.jsx("p",{className:"text-[16px] font-medium leading-[165%] tracking-[-0.03em] text-gray-800 whitespace-pre-wrap break-words",children:s})})},K=({count:e,isActive:s=!1,onClick:i})=>{const c=e>99?"99+":e;return r.jsxs("button",{onClick:i,className:`
        flex items-center justify-center gap-[2px] w-[76px] h-[48px] px-3 py-2.5 rounded-[8px]
        transition-colors
        ${s?"bg-blue-400 text-white":"bg-gray-50 text-gray-600"}
      `,children:[s?r.jsx(P,{className:"w-6 h-6"}):r.jsx(E,{className:"w-6 h-6"}),r.jsx("span",{className:"text-sm font-medium leading-[135%] tracking-[-0.03em]",children:c})]})},z=({status:e,isScrapped:s,scrapCount:i,onToggleScrap:c,onApplyClick:o})=>{const t=e==="regular"||e==="d-day";return r.jsxs("div",{className:"w-full max-w-[420px] fixed bottom-0 left-1/2 -translate-x-1/2 z-10 border-t border-gray-100 bg-white px-4 pt-3 pb-6 flex items-center justify-between gap-2",children:[r.jsx(K,{count:i,isActive:s,onClick:c}),r.jsx("div",{className:"flex-1",children:r.jsx(q,{isActive:t,onClick:o,children:t?"신청하기":"신청 마감"})})]})},W=async e=>{const s=await f.get(`/api/recruitments/${e}`);if(s.data.status!==200)throw new Error(s.data.message);return s.data.data},_=async e=>(await f.get(`/api/recruitments/${e}/images`)).data,y=e=>{if(!e)return 0;const s=new Date,i=new Date(e);s.setHours(0,0,0,0),i.setHours(0,0,0,0);const c=i.getTime()-s.getTime(),o=Math.ceil(c/(1e3*60*60*24));return o<0?0:o},G=(e,s)=>{if(!s)return"regular";const i=y(s);return i===0?"end":i<=7?"d-day":"regular"},J=e=>{const{data:s,isLoading:i,isError:c,error:o}=B({queryKey:["recruitmentPost",e],queryFn:async()=>{if(!e)return null;const t=await W(e),a=await _(e);return{recruitmentId:t.id,clubId:t.clubId,clubName:t.clubName,title:t.title,description:t.description,type:t.type,phoneNumber:t.phoneNumber,email:t.email,startDate:t.startDate,endDate:t.endDate,createdAt:t.createdAt,url:t.url,images:a,status:G(t.type,t.endDate),dDay:y(t.endDate),viewCount:t.viewCount||0,scrapCount:t.saveCount||0,isScrapped:!1}},enabled:!!e});return{data:s,isLoading:i,isError:c,error:o}},ne=()=>{const e=S(),s=D(),i=C(),{recruitmentId:c}=A(),o=c?Number(c):null,t=R(n=>n.isLoggedIn),{data:a,isLoading:h,isError:b,error:j}=J(o),{favorites:l,isLoading:d}=H(),[g,m]=u.useState(!1),[w,p]=u.useState(0),x=u.useMemo(()=>!t||!l||!a?!1:l.some(n=>n.recruitmentId===a.recruitmentId),[t,l,a]);u.useEffect(()=>{a&&p(a.scrapCount)},[a]),u.useEffect(()=>{d||m(x)},[x,d]);const v=async()=>{if(!t){alert("로그인이 필요합니다."),e(`/login?redirect=${s.pathname}`);return}if(a)try{g?(await F(a.recruitmentId),m(!1),p(n=>n>0?n-1:0),i.invalidateQueries({queryKey:["myFavorites"]})):(await T(a.recruitmentId),m(!0),p(n=>n+1),i.invalidateQueries({queryKey:["myFavorites"]}))}catch(n){console.error("Scrap toggle failed:",n),alert("요청에 실패했습니다.")}},N=()=>{if(!a?.url){alert("신청 링크가 없습니다.");return}let n=a.url;!n.startsWith("http://")&&!n.startsWith("https://")&&(n="https://"+n),window.open(n,"_blank","noopener,noreferrer")};return h||t&&d?r.jsx("div",{className:"p-4 text-center",children:"로딩 중..."}):b||!a?r.jsxs("div",{className:"p-4 text-center text-red-500",children:["오류가 발생했습니다: ",j?.message||"공고를 찾을 수 없습니다."]}):r.jsxs("div",{className:"bg-white min-h-screen pb-[80px]",children:[r.jsx(k,{variant:"page"}),r.jsx(M,{title:a.title,status:a.status,dDay:a.dDay,createdAt:a.createdAt}),r.jsx(Q,{imageUrl:a.images[0]||void 0}),r.jsx($,{description:a.description}),r.jsx(z,{status:a.status,isScrapped:g,scrapCount:w,onToggleScrap:v,onApplyClick:N})]})};export{ne as default};
