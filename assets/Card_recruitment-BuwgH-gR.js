import{u as g}from"./useQuery-CQw_5zFM.js";import{c as p,r as d,u as C,d as A,a as T,b as k,j as a}from"./index-DYhfhBFg.js";import{P as q}from"./Chip_period-DDEPzun6.js";import{S as F,a as I,b as R,r as L}from"./recruitment-B2shOhBa.js";import{D as $}from"./Default_images-DTygkBZ9.js";const y=e=>{if(!e)return 0;const t=new Date,r=new Date(e);t.setHours(0,0,0,0),r.setHours(0,0,0,0);const s=r.getTime()-t.getTime(),n=Math.ceil(s/(1e3*60*60*24));return n<0?0:n},E=(e,t)=>{if(e==="상시모집"||!t)return"regular";const r=y(t);return r===0?"end":r<=7?"d-day":"regular"},K=e=>{const t=E(e.type,e.endDate),r=y(e.endDate);return{recruitmentId:e.id,clubId:e.clubId,clubName:e.clubName,title:e.title,description:e.description,type:e.type,phoneNumber:e.phoneNumber,email:e.email,startDate:e.startDate,endDate:e.endDate,url:e.url,createdAt:e.createdAt,images:[],status:t,dDay:r,viewCount:0,isScrapped:!1,scrapCount:0}},Q=async e=>{try{const t=e==="main"?"/api/recruitments/main":"/api/recruitments",r=await p.get(t);if(r.data.status!==200)throw new Error(r.data.message);return Array.isArray(r.data.data)?r.data.data.map(K):[]}catch(t){return console.error(`Error fetching recruitments (${e}):`,t),[]}},J=(e="all")=>{const{data:t=[],isLoading:r,error:s}=g({queryKey:["recruitmentsList",e],queryFn:()=>Q(e)});return{posts:t,isLoading:r,error:s}},z=async e=>{try{return(await p.get(`/api/recruitments/${e}/images`)).data}catch{return[]}},O=({recruitmentId:e,title:t,status:r,dDay:s,viewCount:n,scrapCount:h,isScrappedInitially:f=!1})=>{const[o,l]=d.useState(f),[x,u]=d.useState(h),m=C(),b=A(),j=T(i=>i.isLoggedIn),v=k(),{data:D}=g({queryKey:["recruitmentThumbnail",e],queryFn:()=>z(e),staleTime:1/0}),N=async i=>{if(i.stopPropagation(),!j){alert("로그인이 필요합니다."),m(`/login?redirect=${v.pathname}`);return}try{o?(await L(e),l(!1),u(c=>c-1)):(await R(e),l(!0),u(c=>c+1)),b.invalidateQueries({queryKey:["myFavorites"]})}catch(c){console.error("스크랩 처리 중 오류:",c)}},S=()=>{m(`/recruitments/${e}`)},w=D?.[0]||$;return a.jsxs("div",{className:"flex flex-col w-[109px] min-h-[202px] gap-2 bg-white cursor-pointer",onClick:S,role:"button",tabIndex:0,children:[a.jsxs("div",{className:"relative",children:[a.jsx("img",{className:"w-[109px] h-[109px] object-cover rounded-[8px] border border-gray-100",src:w,alt:`${t} thumbnail`,loading:"lazy",decoding:"async"}),a.jsx("button",{onClick:N,className:"absolute top-2 right-2","aria-label":"스크랩",children:o?a.jsx(F,{className:"w-5 h-5"}):a.jsx(I,{className:"w-5 h-5"})})]}),a.jsx("h3",{className:"text-sm font-medium text-gray-800 leading-[1.35] tracking-[-0.03em] h-[38px] line-clamp-2",children:t}),a.jsx("div",{className:"mt-1 flex justify-start",children:a.jsx(q,{status:r,dDay:s,size:"small"})}),a.jsxs("div",{className:"text-xs text-gray-300 font-normal leading-[1.4] tracking-[-0.02em]",children:[n!==void 0&&a.jsxs("span",{children:["조회 ",n]}),a.jsxs("span",{className:"ml-2",children:["저장 ",x]})]})]})};export{O as R,J as u};
