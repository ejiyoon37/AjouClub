import{j as e,u as v,d as S,f as w,a as N,r as o}from"./index-DWArhSub.js";import{H as C}from"./Header-B5qY0vLE.js";import{P as k}from"./Chip_period-D6F9JhRQ.js";import{f as I,u as A}from"./useRecruitmentDetail-CiAvVslT.js";import{S as D,a as R,r as L,b as F}from"./recruitment-BpmRPh67.js";import{C as B}from"./CTABtn-zPH4AfCv.js";import{u as E}from"./useMypageData-CcG2dxmP.js";import"./icn_search_24-2-WrgszhQ_.js";import"./useQuery-DlTsrqeO.js";const P=({title:r,status:a,dDay:i,createdAt:n})=>e.jsxs("section",{className:"px-4 pt-6 pb-4 bg-white",children:[e.jsx("div",{className:"mb-2",children:e.jsx(k,{status:a,dDay:i,size:"large"})}),e.jsx("h1",{className:"text-[18px] font-semibold text-gray-900 leading-[135%] tracking-[-0.03em]",children:r}),e.jsxs("p",{className:"mt-1 text-sm font-medium text-gray-400 leading-[135%] tracking-[-0.03em]",children:["게시일 ",I(n)]})]}),T=({imageUrl:r})=>r?e.jsx("section",{className:"bg-white px-4",children:e.jsx("img",{src:r,alt:"모집 공고 이미지",className:"w-full rounded-lg object-cover"})}):null,q=({description:r})=>{const a=r.replace(/\\n/g,`
`);return e.jsx("section",{className:"bg-gray-50 rounded-[12px] px-4 py-5 mt-6",children:e.jsx("p",{className:"text-[16px] font-medium leading-[165%] tracking-[-0.03em] text-gray-800 whitespace-pre-wrap break-words",children:a})})},M=({count:r,isActive:a=!1,onClick:i})=>{const n=r>99?"99+":r;return e.jsxs("button",{onClick:i,className:`
        flex items-center justify-center gap-[2px] w-[76px] h-[48px] px-3 py-2.5 rounded-[8px]
        transition-colors
        ${a?"bg-blue-400 text-white":"bg-gray-50 text-gray-600"}
      `,children:[a?e.jsx(D,{className:"w-6 h-6"}):e.jsx(R,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium leading-[135%] tracking-[-0.03em]",children:n})]})},Q=({status:r,isScrapped:a,scrapCount:i,onToggleScrap:n,onApplyClick:c})=>{const t=r==="regular"||r==="d-day";return e.jsxs("div",{className:"w-full max-w-[420px] fixed bottom-0 left-1/2 -translate-x-1/2 z-10 border-t border-gray-100 bg-white px-4 pt-3 pb-6 flex items-center justify-between gap-2",children:[e.jsx(M,{count:i,isActive:a,onClick:n}),e.jsx("div",{className:"flex-1",children:e.jsx(B,{isActive:t,onClick:c,children:t?"신청하기":"신청 마감"})})]})},V=()=>{const r=v(),a=S(),{clubId:i}=w(),n=i?Number(i):null,c=N(s=>s.isLoggedIn),{data:t,isLoading:g,isError:f,error:h}=A(n),{favorites:l,isLoading:d}=E(),[p,m]=o.useState(!1),[j,u]=o.useState(0),x=o.useMemo(()=>!c||!l||!t?!1:l.some(s=>s.recruitmentId===t.recruitmentId),[c,l,t]);o.useEffect(()=>{t&&u(t.scrapCount)},[t]),o.useEffect(()=>{d||m(x)},[x,d]);const y=async()=>{if(!c){alert("로그인이 필요합니다."),r(`/login?redirect=${location.pathname}`);return}if(t)try{p?(await L(t.recruitmentId),m(!1),u(s=>s>0?s-1:0),a.invalidateQueries({queryKey:["myFavorites"]})):(await F(t.recruitmentId),m(!0),u(s=>s+1),a.invalidateQueries({queryKey:["myFavorites"]}))}catch(s){console.error("Scrap toggle failed:",s),alert("요청에 실패했습니다.")}},b=()=>{if(!t?.url){alert("신청 링크가 없습니다.");return}let s=t.url;!s.startsWith("http://")&&!s.startsWith("https://")&&(s="https://"+s),window.open(s,"_blank","noopener,noreferrer")};return g||c&&d?e.jsx("div",{className:"p-4 text-center",children:"로딩 중..."}):f||!t?e.jsxs("div",{className:"p-4 text-center text-red-500",children:["오류가 발생했습니다: ",h?.message||"공고를 찾을 수 없습니다."]}):e.jsxs("div",{className:"bg-white min-h-screen pb-[80px]",children:[e.jsx(C,{variant:"page"}),e.jsx(P,{title:t.title,status:t.status,dDay:t.dDay,createdAt:t.createdAt}),e.jsx(T,{imageUrl:t.images[0]||void 0}),e.jsx(q,{description:t.description}),e.jsx(Q,{status:t.status,isScrapped:p,scrapCount:j,onToggleScrap:y,onApplyClick:b})]})};export{V as default};
