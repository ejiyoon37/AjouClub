import{j as r,c as x,u as N,d as S,f as D,a as C,r as o}from"./index-BOwi9D-X.js";import{H as A}from"./Header-Bl0UjeGb.js";import{P as R}from"./Chip_period-BWFeznSV.js";import{f as k}from"./date-B0GoYsVM.js";import{S as I,a as L,r as P,b as E}from"./recruitment-D7m2rquX.js";import{C as F}from"./CTABtn-X50llVXQ.js";import{u as T}from"./useQuery-XMJWr1Nc.js";import{u as q}from"./useMypageData-CYxz-tvW.js";import"./icn_search_24-2-BruKq-2o.js";const B=({title:t,status:s,dDay:a,createdAt:n})=>r.jsxs("section",{className:"px-4 pt-6 pb-4 bg-white",children:[r.jsx("div",{className:"mb-2",children:r.jsx(R,{status:s,dDay:a,size:"large"})}),r.jsx("h1",{className:"text-[18px] font-semibold text-gray-900 leading-[135%] tracking-[-0.03em]",children:t}),r.jsxs("p",{className:"mt-1 text-sm font-medium text-gray-400 leading-[135%] tracking-[-0.03em]",children:["게시일 ",k(n)]})]}),H=({imageUrl:t})=>t?r.jsx("section",{className:"bg-white px-4",children:r.jsx("img",{src:t,alt:"모집 공고 이미지",className:"w-full rounded-lg object-cover"})}):null,M=({description:t})=>{const s=t.replace(/\\n/g,`
`);return r.jsx("section",{className:"bg-gray-50 rounded-[12px] px-4 py-5 mt-6",children:r.jsx("p",{className:"text-[16px] font-medium leading-[165%] tracking-[-0.03em] text-gray-800 whitespace-pre-wrap break-words",children:s})})},Q=({count:t,isActive:s=!1,onClick:a})=>{const n=t>99?"99+":t;return r.jsxs("button",{onClick:a,className:`
        flex items-center justify-center gap-[2px] w-[76px] h-[48px] px-3 py-2.5 rounded-[8px]
        transition-colors
        ${s?"bg-blue-400 text-white":"bg-gray-50 text-gray-600"}
      `,children:[s?r.jsx(I,{className:"w-6 h-6"}):r.jsx(L,{className:"w-6 h-6"}),r.jsx("span",{className:"text-sm font-medium leading-[135%] tracking-[-0.03em]",children:n})]})},$=({status:t,isScrapped:s,scrapCount:a,onToggleScrap:n,onApplyClick:c})=>{const e=t==="regular"||t==="d-day";return r.jsxs("div",{className:"w-full max-w-[420px] fixed bottom-0 left-1/2 -translate-x-1/2 z-10 border-t border-gray-100 bg-white px-4 pt-3 pb-6 flex items-center justify-between gap-2",children:[r.jsx(Q,{count:a,isActive:s,onClick:n}),r.jsx("div",{className:"flex-1",children:r.jsx(F,{isActive:e,onClick:c,children:e?"신청하기":"신청 마감"})})]})},K=async t=>{const s=await x.get(`/api/recruitments/${t}`);if(s.data.status!==200)throw new Error(s.data.message);return s.data.data},z=async t=>(await x.get(`/api/recruitments/${t}/images`)).data,y=t=>{if(!t)return 0;const s=new Date,a=new Date(t);s.setHours(0,0,0,0),a.setHours(0,0,0,0);const n=a.getTime()-s.getTime(),c=Math.ceil(n/(1e3*60*60*24));return c<0?0:c},W=(t,s)=>{if(t==="상시모집"||!s)return"regular";const a=y(s);return a===0?"end":a<=7?"d-day":"regular"},_=t=>{const{data:s,isLoading:a,isError:n,error:c}=T({queryKey:["recruitmentPost",t],queryFn:async()=>{if(!t)return null;const e=await K(t),u=await z(t);return{recruitmentId:e.id,clubId:e.clubId,clubName:e.clubName,title:e.title,description:e.description,type:e.type,phoneNumber:e.phoneNumber,email:e.email,startDate:e.startDate,endDate:e.endDate,createdAt:e.createdAt,url:e.url,images:u,status:W(e.type,e.endDate),dDay:y(e.endDate),isScrapped:!1,scrapCount:0}},enabled:!!t});return{data:s,isLoading:a,isError:n,error:c}},re=()=>{const t=N(),s=S(),{recruitmentId:a}=D(),n=a?Number(a):null,c=C(i=>i.isLoggedIn),{data:e,isLoading:u,isError:h,error:b}=_(n),{favorites:l,isLoading:d}=q(),[g,m]=o.useState(!1),[j,p]=o.useState(0),f=o.useMemo(()=>!c||!l||!e?!1:l.some(i=>i.recruitmentId===e.recruitmentId),[c,l,e]);o.useEffect(()=>{e&&p(e.scrapCount)},[e]),o.useEffect(()=>{d||m(f)},[f,d]);const w=async()=>{if(!c){alert("로그인이 필요합니다."),t(`/login?redirect=${location.pathname}`);return}if(e)try{g?(await P(e.recruitmentId),m(!1),p(i=>i>0?i-1:0),s.invalidateQueries({queryKey:["myFavorites"]})):(await E(e.recruitmentId),m(!0),p(i=>i+1),s.invalidateQueries({queryKey:["myFavorites"]}))}catch(i){console.error("Scrap toggle failed:",i),alert("요청에 실패했습니다.")}},v=()=>{if(!e?.url){alert("신청 링크가 없습니다.");return}let i=e.url;!i.startsWith("http://")&&!i.startsWith("https://")&&(i="https://"+i),window.open(i,"_blank","noopener,noreferrer")};return u||c&&d?r.jsx("div",{className:"p-4 text-center",children:"로딩 중..."}):h||!e?r.jsxs("div",{className:"p-4 text-center text-red-500",children:["오류가 발생했습니다: ",b?.message||"공고를 찾을 수 없습니다."]}):r.jsxs("div",{className:"bg-white min-h-screen pb-[80px]",children:[r.jsx(A,{variant:"page"}),r.jsx(B,{title:e.title,status:e.status,dDay:e.dDay,createdAt:e.createdAt}),r.jsx(H,{imageUrl:e.images[0]||void 0}),r.jsx(M,{description:e.description}),r.jsx($,{status:e.status,isScrapped:g,scrapCount:j,onToggleScrap:w,onApplyClick:v})]})};export{re as default};
