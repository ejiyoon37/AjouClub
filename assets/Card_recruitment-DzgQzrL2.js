import{u as p}from"./useQuery-DlTsrqeO.js";import{c as h,r as g,u as A,d as T,a as I,b as k,j as a}from"./index-DWArhSub.js";import{P as q}from"./Chip_period-D6F9JhRQ.js";import{S as F,a as R,b as L,r as E}from"./recruitment-BpmRPh67.js";import{D as $}from"./Default_images-DTygkBZ9.js";const y=e=>{if(!e)return 0;const t=new Date,r=new Date(e);t.setHours(0,0,0,0),r.setHours(0,0,0,0);const c=r.getTime()-t.getTime(),n=Math.ceil(c/(1e3*60*60*24));return n<0?0:n},K=(e,t)=>{if(e==="상시모집"||!t)return"regular";const r=y(t);return r===0?"end":r<=7?"d-day":"regular"},Q=e=>{const t=K(e.type,e.endDate),r=y(e.endDate);return{recruitmentId:e.id,clubId:e.clubId,clubName:e.clubName,title:e.title,description:e.description,type:e.type,phoneNumber:e.phoneNumber,email:e.email,startDate:e.startDate,endDate:e.endDate,url:e.url,createdAt:e.createdAt,images:[],status:t,dDay:r,viewCount:0,isScrapped:!1,scrapCount:0}},B=async()=>{try{const e=await h.get("/api/recruitments");if(e.data.status!==200)throw new Error(e.data.message);return Array.isArray(e.data.data)?e.data.data.map(Q):[]}catch(e){return console.error("Error fetching recruitments:",e),[]}},O=()=>{const{data:e=[],isLoading:t,error:r}=p({queryKey:["recruitmentsList"],queryFn:B});return{posts:e,isLoading:t,error:r}},H=async e=>{try{return(await h.get(`/api/recruitments/${e}/images`)).data}catch{return[]}},V=({recruitmentId:e,clubId:t,title:r,status:c,dDay:n,viewCount:o,scrapCount:f,isScrappedInitially:x=!1})=>{const[u,l]=g.useState(x),[b,m]=g.useState(f),d=A(),v=T(),j=I(i=>i.isLoggedIn),D=k(),{data:N}=p({queryKey:["recruitmentThumbnail",e],queryFn:()=>H(e),staleTime:1/0}),S=async i=>{if(i.stopPropagation(),!j){alert("로그인이 필요합니다."),d(`/login?redirect=${D.pathname}`);return}try{u?(await E(e),l(!1),m(s=>s-1)):(await L(e),l(!0),m(s=>s+1)),v.invalidateQueries({queryKey:["myFavorites"]})}catch(s){console.error("스크랩 처리 중 오류:",s)}},w=()=>{d(`/recruitments/${t}`)},C=N?.[0]||$;return a.jsxs("div",{className:"flex flex-col w-[109px] min-h-[202px] gap-2 bg-white cursor-pointer",onClick:w,role:"button",tabIndex:0,children:[a.jsxs("div",{className:"relative",children:[a.jsx("img",{className:"w-[109px] h-[109px] object-cover rounded-[8px] border border-gray-100",src:C,alt:`${r} thumbnail`}),a.jsx("button",{onClick:S,className:"absolute top-2 right-2","aria-label":"스크랩",children:u?a.jsx(F,{className:"w-5 h-5"}):a.jsx(R,{className:"w-5 h-5"})})]}),a.jsx("h3",{className:"text-sm font-medium text-gray-800 leading-[1.35] tracking-[-0.03em] h-[38px] line-clamp-2",children:r}),a.jsx("div",{className:"mt-1 flex justify-start",children:a.jsx(q,{status:c,dDay:n,size:"small"})}),a.jsxs("div",{className:"text-xs text-gray-300 font-normal leading-[1.4] tracking-[-0.02em]",children:[o!==void 0&&a.jsxs("span",{children:["조회 ",o]}),a.jsxs("span",{className:"ml-2",children:["저장 ",b]})]})]})};export{V as R,O as u};
