import{j as t,c as x,u as S,b as D,d as C,f as A,a as R,r as u}from"./index-DacEIc5C.js";import{H as k}from"./Header-CEzJuSZ3.js";import{P as I}from"./Chip_period-CF9hB-RN.js";import{f as L}from"./date-B0GoYsVM.js";import{S as P,a as E,r as F,b as T}from"./recruitment-BYnCljy3.js";import{C as q}from"./CTABtn-fr0brCkz.js";import{u as B}from"./useQuery-CRLXNPUU.js";import{u as H}from"./useMypageData-DsrNlLzP.js";import"./icn_search_24-2-BVm-53NN.js";const M=({title:e,status:r,dDay:i,createdAt:c})=>t.jsxs("section",{className:"px-4 pt-6 pb-4 bg-white",children:[t.jsx("div",{className:"mb-2",children:t.jsx(I,{status:r,dDay:i,size:"large"})}),t.jsx("h1",{className:"text-[18px] font-semibold text-gray-900 leading-[135%] tracking-[-0.03em]",children:e}),t.jsxs("p",{className:"mt-1 text-sm font-medium text-gray-400 leading-[135%] tracking-[-0.03em]",children:["게시일 ",L(c)]})]}),Q=({imageUrl:e})=>e?t.jsx("section",{className:"bg-white px-4",children:t.jsx("img",{src:e,alt:"모집 공고 이미지",className:"w-full rounded-lg object-cover"})}):null,$=({description:e})=>{const r=e.replace(/\\n/g,`
`);return t.jsx("section",{className:"bg-gray-50 rounded-[12px] px-4 py-5 mt-6",children:t.jsx("p",{className:"text-[16px] font-medium leading-[165%] tracking-[-0.03em] text-gray-800 whitespace-pre-wrap break-words",children:r})})},K=({count:e,isActive:r=!1,onClick:i})=>{const c=e>99?"99+":e;return t.jsxs("button",{onClick:i,className:`
        flex items-center justify-center gap-[2px] w-[76px] h-[48px] px-3 py-2.5 rounded-[8px]
        transition-colors
        ${r?"bg-blue-400 text-white":"bg-gray-50 text-gray-600"}
      `,children:[r?t.jsx(P,{className:"w-6 h-6"}):t.jsx(E,{className:"w-6 h-6"}),t.jsx("span",{className:"text-sm font-medium leading-[135%] tracking-[-0.03em]",children:c})]})},z=({status:e,isScrapped:r,scrapCount:i,onToggleScrap:c,onApplyClick:o})=>{const s=e==="regular"||e==="d-day";return t.jsxs("div",{className:"w-full max-w-[420px] fixed bottom-0 left-1/2 -translate-x-1/2 z-10 border-t border-gray-100 bg-white px-4 pt-3 pb-6 flex items-center justify-between gap-2",children:[t.jsx(K,{count:i,isActive:r,onClick:c}),t.jsx("div",{className:"flex-1",children:t.jsx(q,{isActive:s,onClick:o,children:s?"신청하기":"신청 마감"})})]})},W=async e=>{const r=await x.get(`/api/recruitments/${e}`);if(r.data.status!==200)throw new Error(r.data.message);return r.data.data},_=async e=>(await x.get(`/api/recruitments/${e}/images`)).data,y=e=>{if(!e)return 0;const r=new Date,i=new Date(e);r.setHours(0,0,0,0),i.setHours(0,0,0,0);const c=i.getTime()-r.getTime(),o=Math.ceil(c/(1e3*60*60*24));return o<0?0:o},G=(e,r)=>{if(e==="상시모집"||!r)return"regular";const i=y(r);return i===0?"end":i<=7?"d-day":"regular"},J=e=>{const{data:r,isLoading:i,isError:c,error:o}=B({queryKey:["recruitmentPost",e],queryFn:async()=>{if(!e)return null;const s=await W(e),a=await _(e);return{recruitmentId:s.id,clubId:s.clubId,clubName:s.clubName,title:s.title,description:s.description,type:s.type,phoneNumber:s.phoneNumber,email:s.email,startDate:s.startDate,endDate:s.endDate,createdAt:s.createdAt,url:s.url,images:a,status:G(s.type,s.endDate),dDay:y(s.endDate),isScrapped:!1,scrapCount:0}},enabled:!!e});return{data:r,isLoading:i,isError:c,error:o}},ae=()=>{const e=S(),r=D(),i=C(),{recruitmentId:c}=A(),o=c?Number(c):null,s=R(n=>n.isLoggedIn),{data:a,isLoading:h,isError:b,error:j}=J(o),{favorites:l,isLoading:d}=H(),[g,m]=u.useState(!1),[w,p]=u.useState(0),f=u.useMemo(()=>!s||!l||!a?!1:l.some(n=>n.recruitmentId===a.recruitmentId),[s,l,a]);u.useEffect(()=>{a&&p(a.scrapCount)},[a]),u.useEffect(()=>{d||m(f)},[f,d]);const v=async()=>{if(!s){alert("로그인이 필요합니다."),e(`/login?redirect=${r.pathname}`);return}if(a)try{g?(await F(a.recruitmentId),m(!1),p(n=>n>0?n-1:0),i.invalidateQueries({queryKey:["myFavorites"]})):(await T(a.recruitmentId),m(!0),p(n=>n+1),i.invalidateQueries({queryKey:["myFavorites"]}))}catch(n){console.error("Scrap toggle failed:",n),alert("요청에 실패했습니다.")}},N=()=>{if(!a?.url){alert("신청 링크가 없습니다.");return}let n=a.url;!n.startsWith("http://")&&!n.startsWith("https://")&&(n="https://"+n),window.open(n,"_blank","noopener,noreferrer")};return h||s&&d?t.jsx("div",{className:"p-4 text-center",children:"로딩 중..."}):b||!a?t.jsxs("div",{className:"p-4 text-center text-red-500",children:["오류가 발생했습니다: ",j?.message||"공고를 찾을 수 없습니다."]}):t.jsxs("div",{className:"bg-white min-h-screen pb-[80px]",children:[t.jsx(k,{variant:"page"}),t.jsx(M,{title:a.title,status:a.status,dDay:a.dDay,createdAt:a.createdAt}),t.jsx(Q,{imageUrl:a.images[0]||void 0}),t.jsx($,{description:a.description}),t.jsx(z,{status:a.status,isScrapped:g,scrapCount:w,onToggleScrap:v,onApplyClick:N})]})};export{ae as default};
